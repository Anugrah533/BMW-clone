(function(){function l(b){b=b.dataset;var e=[],c="search";c=c.charAt(0).toUpperCase()+c.slice(1);c=["is","hook"+c];for(var a in b)if(Object.prototype.hasOwnProperty.call(b,a)){var d=b[a];0===a.indexOf("cmp")&&(a=a.slice(3),a=a.charAt(0).toLowerCase()+a.substring(1),-1===c.indexOf(a)&&(e[a]=d))}return e}function g(b,e){b&&(!1!==e?(b.style.display="block",b.setAttribute("aria-hidden",!1)):(b.style.display="none",b.setAttribute("aria-hidden",!0)))}function f(b){var e=[];if(b&&b.elements)for(var c=0;c<
b.elements.length;c++){var a=b.elements[c];!a.disabled&&a.name&&(a=[a.name,encodeURIComponent(a.value)],e.push(a.join("\x3d")))}return e.join("\x26")}function c(b,e){if(b&&e)if(3===b.nodeType){var a=b.nodeValue;e=e.exec(a);if(a&&e){a=document.createElement("mark");a.className="cmp-search__item-mark";a.appendChild(document.createTextNode(e[0]));var d=b.splitText(e.index);d.nodeValue=d.nodeValue.substring(e[0].length);b.parentNode.insertBefore(a,d)}}else if(b.hasChildNodes())for(a=0;a<b.childNodes.length;a++)c(b.childNodes[a],
e)}function d(b,a){b=document.querySelector("#"+b+"\x3e .cmp_search__info");b.style.visibility="visible";b.innerText=0<a?1===a?a+" result":a+" results":"No results"}function a(b){b.element&&b.element.removeAttribute("data-cmp-is");this._cacheElements(b.element);this._setupProperties(b.options);this._action=this._elements.form.getAttribute("action");this._resultsOffset=0;this._hasMoreResults=!0;this._elements.input.addEventListener("input",this._onInput.bind(this));this._elements.input.addEventListener("focus",
this._onInput.bind(this));this._elements.input.addEventListener("keydown",this._onKeydown.bind(this));this._elements.clear.addEventListener("click",this._onClearClick.bind(this));document.addEventListener("click",this._onDocumentClick.bind(this));this._elements.results.addEventListener("scroll",this._onScroll.bind(this));this._makeAccessible()}function k(){for(var b=document.querySelectorAll(h.self),e=0;e<b.length;e++)new a({element:b[e],options:l(b[e])});b=window.MutationObserver||window.WebKitMutationObserver||
window.MozMutationObserver;e=document.querySelector("body");(new b(function(b){b.forEach(function(b){b=[].slice.call(b.addedNodes);0<b.length&&b.forEach(function(b){b.querySelectorAll&&[].slice.call(b.querySelectorAll(h.self)).forEach(function(b){new a({element:b,options:l(b)})})})})})).observe(e,{subtree:!0,childList:!0,characterData:!0})}var h={self:'[data-cmp-is\x3d"search"]',item:{self:'[data-cmp-hook-search\x3d"item"]',title:'[data-cmp-hook-search\x3d"itemTitle"]',focused:".cmp-search__item--is-focused"}},
m={minLength:{"default":3,transform:function(b){b=parseFloat(b);return isNaN(b)?null:b}},resultsSize:{"default":10,transform:function(b){b=parseFloat(b);return isNaN(b)?null:b}}},n=0;a.prototype._displayResults=function(){0===this._elements.input.value.length?(g(this._elements.clear,!1),this._cancelResults()):(this._elements.input.value.length<this._properties.minLength||this._updateResults(),g(this._elements.clear,!0))};a.prototype._onScroll=function(b){this._elements.results.scrollTop+2*this._elements.results.clientHeight>=
this._elements.results.scrollHeight&&(this._resultsOffset+=this._properties.resultsSize,this._displayResults())};a.prototype._onInput=function(b){var a=this;a._cancelResults();this._timeout=setTimeout(function(){a._displayResults()},300)};a.prototype._onKeydown=function(b){switch(b.keyCode){case 9:this._resultsOpen()&&(g(this._elements.results,!1),this._elements.input.setAttribute("aria-expanded","false"),this._hideSearchResultsStatusMessage());break;case 13:b.preventDefault();this._resultsOpen()&&
(b=this._elements.results.querySelector(h.item.focused))&&b.click();break;case 27:this._cancelResults();break;case 38:this._resultsOpen()&&(b.preventDefault(),this._stepResultFocus(!0));break;case 40:this._resultsOpen()?(b.preventDefault(),this._stepResultFocus()):this._onInput()}};a.prototype._onClearClick=function(b){b.preventDefault();this._elements.input.value="";g(this._elements.clear,!1);g(this._elements.results,!1);this._elements.input.setAttribute("aria-expanded","false");this._hideSearchResultsStatusMessage()};
a.prototype._onDocumentClick=function(b){var a=this._elements.input.contains(b.target);b=this._elements.results.contains(b.target);a||b||(g(this._elements.results,!1),this._elements.input.setAttribute("aria-expanded","false"),this._hideSearchResultsStatusMessage())};a.prototype._resultsOpen=function(){return"none"!==this._elements.results.style.display};a.prototype._makeAccessible=function(){var b="cmp-search-results-"+n;this._elements.input.setAttribute("aria-owns",b);this._elements.results.id=b;
n++};a.prototype._generateItems=function(b,a){var c=this;b.forEach(function(b){var e=document.createElement("span");e.innerHTML=c._elements.itemTemplate.innerHTML;e.querySelectorAll(h.item.title)[0].appendChild(document.createTextNode(b.title));e.querySelectorAll(h.item.self)[0].setAttribute("href",b.url);a.innerHTML+=e.innerHTML})};a.prototype._markResults=function(){var b=this._elements.results.querySelectorAll(h.item.self),a=this._elements.input.value.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$\x26");
a=new RegExp("("+a+")","gi");for(var d=this._resultsOffset-1;d<b.length;++d)c(b[d],a)};a.prototype._stepResultFocus=function(b){var a=this._elements.results.querySelectorAll(h.item.self),c=this._elements.results.querySelector(h.item.focused);c=Array.prototype.indexOf.call(a,c);if(0<a.length)if(b){if(1<=c&&(a[c].classList.remove("cmp-search__item--is-focused"),a[c].setAttribute("aria-selected","false"),a[c-1].classList.add("cmp-search__item--is-focused"),a[c-1].setAttribute("aria-selected","true")),
b=this._elements.results.querySelector(h.item.focused))b=this._elements.results.scrollTop-b.offsetTop,0<b&&(this._elements.results.scrollTop-=b)}else if(0>c?(a[0].classList.add("cmp-search__item--is-focused"),a[0].setAttribute("aria-selected","true")):c+1<a.length&&(a[c].classList.remove("cmp-search__item--is-focused"),a[c].setAttribute("aria-selected","false"),a[c+1].classList.add("cmp-search__item--is-focused"),a[c+1].setAttribute("aria-selected","true")),b=this._elements.results.querySelector(h.item.focused))b=
b.offsetTop+b.offsetHeight-this._elements.results.scrollTop-this._elements.results.clientHeight,0<b?this._elements.results.scrollTop+=b:this._onScroll()};a.prototype._updateResults=function(){var b=this;if(b._hasMoreResults){var a=new XMLHttpRequest,c=b._action+"?"+f(b._elements.form)+"\x26resultsOffset\x3d"+b._resultsOffset;a.open("GET",c,!0);a.onload=function(){setTimeout(function(){g(b._elements.loadingIndicator,!1);g(b._elements.icon,!0)},300);if(200<=a.status&&400>a.status){var c=JSON.parse(a.responseText);
d(b._elements.self.id,c.length);0<c.length?(b._generateItems(c,b._elements.results),b._markResults(),g(b._elements.results,!0),b._elements.input.setAttribute("aria-expanded","true")):b._hasMoreResults=!1;0<b._elements.results.querySelectorAll(h.item.self).length%b._properties.resultsSize&&(b._hasMoreResults=!1)}};g(b._elements.loadingIndicator,!0);g(b._elements.icon,!1);a.send()}};a.prototype._cancelResults=function(){clearTimeout(this._timeout);this._resultsOffset=this._elements.results.scrollTop=
0;this._hasMoreResults=!0;this._elements.results.innerHTML="";this._elements.input.setAttribute("aria-expanded","false");this._hideSearchResultsStatusMessage()};a.prototype._hideSearchResultsStatusMessage=function(){document.querySelector("#"+this._elements.self.id+"\x3e .cmp_search__info").style.visibility="hidden"};a.prototype._cacheElements=function(b){this._elements={};this._elements.self=b;b=this._elements.self.querySelectorAll("[data-cmp-hook-search]");for(var a=0;a<b.length;a++){var c=b[a],
d="search";d=d.charAt(0).toUpperCase()+d.slice(1);this._elements[c.dataset["cmpHook"+d]]=c}};a.prototype._setupProperties=function(b){this._properties={};for(var a in m)if(Object.prototype.hasOwnProperty.call(m,a)){var c=m[a];this._properties[a]=b&&null!=b[a]?c&&"function"===typeof c.transform?c.transform(b[a]):b[a]:m[a]["default"]}};"loading"!==document.readyState?k():document.addEventListener("DOMContentLoaded",k)})();var grpw;
(function(l){(function(g){var f=function(){};f.prototype.init=function(c,d){var a=this;this.jqComponent=$(c);this.baseUseClass=d;this.counterTemplate=this.jqComponent.attr("data-results-counter");this.queryURL=this.jqComponent.attr("data-url-query");this.jqQueryField=this.jqComponent.find(".grp-search__query-field");this.jqSubmit=this.jqComponent.find(".grp-search__query-submit");this.jqReset=this.jqComponent.find(".grp-search__reset");this.jqCheckboxes=this.jqComponent.find(".grp-search__checkbox");
this.jqNoResults=this.jqComponent.find(".grp-search__results-noresults");this.jqError=this.jqComponent.find(".grp-search__results-error");this.jqCounter=this.jqComponent.find(".grp-search__results-counter");this.jqResults=this.jqComponent.find(".grp-search__results-area");this.jqLoadMoreButton=this.jqComponent.find(".grp-search__load-more");this.jqTemplateItem=this.jqComponent.find(".grp-search__results-template").html();this.paginationStart=0;this.NU=null;this.autoSuggestObject=new g.Autosuggest(this.jqComponent,
function(){return a.reset()},function(c){return a.executeSearch(c)});this.jqQueryField.focus();c=this.extractSearchParameter("q");0<c.length&&(this.jqQueryField.val(c),this.executeSearch())};f.prototype.initEventHandlers=function(){var c=this;this.autoSuggestObject.initEventHandlers();this.jqSubmit.on("click",function(){c.reset();c.executeSearch()});this.jqReset.on("click",function(){c.reset();c.jqQueryField.val("")});this.jqCheckboxes.on("change",function(d){var a=!1;c.jqCheckboxes.each(function(c,
d){$(d).prop("checked")&&(a=!0)});a||c.jqCheckboxes.not(d.target).prop("checked",!0);c.reset();c.executeSearch()});this.jqLoadMoreButton.on("click",function(){c.paginationStart+=f.PAGINATION;c.executeSearch()})};f.prototype.reset=function(){this.jqNoResults.hide();this.jqCounter.hide();this.jqResults.html("");this.paginationStart=0;this.NU=null;this.jqLoadMoreButton.hide()};f.prototype.evalQuery=function(c){void 0===c&&(c=this.jqQueryField.val());return c};f.prototype.collectCheckboxValues=function(){var c=
[];this.jqCheckboxes.each(function(d,a){$(a).prop("checked")&&c.push($(a).attr("value"))});2===c.length&&(c=[]);return c};f.prototype.createApiUrl=function(c){c=void 0!==c?encodeURIComponent(c):encodeURIComponent(this.jqQueryField.val());var d=this.queryURL;null===this.NU?(d+="?",d+="q\x3d"+c+"\x26",d+="num\x3d"+f.PAGINATION+"\x26start\x3d"+this.paginationStart+"\x26",this.collectCheckboxValues().forEach(function(a){d+="\x26as_q\x3d"+a})):d=this.queryURL+this.NU;return d};f.prototype.displayReplace=
function(c){return null!=c?(c=c.replace(/(&lt;b&gt;\.\.\.&lt;\/b&gt;)/g,"..."),c=c.replace(/&lt;/g,"\x3c").replace(/&gt;/g,"\x3e")):""};f.prototype.generateOutput=function(c){for(var d=0;d<c.length&&d<f.PAGINATION;d++){var a=this.jqTemplateItem;if(void 0!==c[d].U&&c[d].U.includes("/dam/")){var k="grp-search__icon-asset";var h="_blank"}else k="grp-search__icon-page",h="_self";a=a.replace(/###target###/g,h);a=a.replace(/###icon###/g,k);a=a.replace(/###label###/g,this.displayReplace(c[d].T));a=a.replace(/###title###/g,
this.displayReplace(c[d].T));a=a.replace(/###text###/g,this.displayReplace(c[d].S));k=c[d].U;a=a.replace(/###linkURL###/g,this.displayReplace(k));a=a.replace(/###link###/g,this.displayReplace(k.replace(/\//g,"\x3cwbr\x3e/")).replace("%20"," "));a=a.replace(/<b>\.\.\.<\/b>/g,"\x3cstrong\x3e...\x3c/strong\x3e");this.jqResults.append(a)}$(".grp-search__results__item").animate({opacity:1});this.jqLoadMoreButton.animate({opacity:1})};f.prototype.executeSearch=function(c){var d=this;c=this.evalQuery(c);
var a=this.createApiUrl(c);$.ajax({type:"GET",url:a,success:function(a){if("undefined"!==typeof a.GSP.RES){var f=a.GSP.RES.M;var g=String(Math.min(a.GSP.RES.EN,a.GSP.RES.M));g=d.counterTemplate.replace(/\{1}/,"1").replace(/\{2}/,g).replace(/\{3}/,a.GSP.RES.M);d.jqCounter.html(g).show();d.NU=void 0===a.GSP.RES.NB?void 0:a.GSP.RES.NB.NU;d.jqNoResults.hide().animate({opacity:0});d.jqError.hide().animate({opacity:1});void 0===d.NU?d.jqLoadMoreButton.hide():d.jqLoadMoreButton.show();d.generateOutput(a.GSP.RES.R)}else f=
"0",d.jqNoResults.show().animate({opacity:1}),d.jqError.hide().animate({opacity:1}),d.jqLoadMoreButton.hide(),d.jqResults.html("");d.baseUseClass.getTracking().trackSearch("bmwgroup_search",{searchType:"Standard Search",searchTerm:c,searchResults:f})},error:function(){d.jqError.show().animate({opacity:1});d.jqNoResults.hide().animate({opacity:0})}})};f.prototype.extractSearchParameter=function(c){var d="";(c=(new RegExp("[?\x26]"+encodeURIComponent(c)+"\x3d([^\x26]*)")).exec(window.location.search))&&
(d=decodeURIComponent(c[1]));return d};f.PAGINATION=10;g.Search=f})(l.component||(l.component={}))})(grpw||(grpw={}));